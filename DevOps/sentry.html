<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sentry | FED</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/dev/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/dev/assets/css/0.styles.4f7070c5.css" as="style"><link rel="preload" href="/dev/assets/js/app.f1eb2c07.js" as="script"><link rel="preload" href="/dev/assets/js/2.e5260363.js" as="script"><link rel="preload" href="/dev/assets/js/10.b17e0bf5.js" as="script"><link rel="prefetch" href="/dev/assets/js/11.dfe0b9ae.js"><link rel="prefetch" href="/dev/assets/js/12.fe2ef6fc.js"><link rel="prefetch" href="/dev/assets/js/13.69469be5.js"><link rel="prefetch" href="/dev/assets/js/14.f23fef41.js"><link rel="prefetch" href="/dev/assets/js/15.4802a148.js"><link rel="prefetch" href="/dev/assets/js/16.6a72a876.js"><link rel="prefetch" href="/dev/assets/js/17.e7cab234.js"><link rel="prefetch" href="/dev/assets/js/18.e5fc7ec6.js"><link rel="prefetch" href="/dev/assets/js/3.da4686f2.js"><link rel="prefetch" href="/dev/assets/js/4.c19a3275.js"><link rel="prefetch" href="/dev/assets/js/5.58b7cc8f.js"><link rel="prefetch" href="/dev/assets/js/6.f9d50154.js"><link rel="prefetch" href="/dev/assets/js/7.bd7eea3e.js"><link rel="prefetch" href="/dev/assets/js/8.efa3b4a2.js"><link rel="prefetch" href="/dev/assets/js/9.685cd26d.js">
    <link rel="stylesheet" href="/dev/assets/css/0.styles.4f7070c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dev/" class="home-link router-link-active"><img src="/dev/logo.png" alt="FED" class="logo"> <span class="site-name can-hide">FED</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/" class="nav-link">
  项目创建
</a></div><div class="nav-item"><a href="/dev/DevOps/" class="nav-link router-link-active">
  DevOps
</a></div><div class="nav-item"><a href="/dev/packages.html" class="nav-link">
  工具/库
</a></div><div class="nav-item"><a href="/dev/post/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/dev/qa.html" class="nav-link">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://open.workplus.io/v4/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开放平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://open.workplus.io/cordova/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cordova 文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/WorkPlusFE/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/" class="nav-link">
  项目创建
</a></div><div class="nav-item"><a href="/dev/DevOps/" class="nav-link router-link-active">
  DevOps
</a></div><div class="nav-item"><a href="/dev/packages.html" class="nav-link">
  工具/库
</a></div><div class="nav-item"><a href="/dev/post/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/dev/qa.html" class="nav-link">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://open.workplus.io/v4/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开放平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://open.workplus.io/cordova/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cordova 文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/WorkPlusFE/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发与发布</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/DevOps/" aria-current="page" class="sidebar-link">w6s-cli</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/DevOps/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#项目创建" class="sidebar-link">项目创建</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#文件静态服务" class="sidebar-link">文件静态服务</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#资源发布" class="sidebar-link">资源发布</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#设置源" class="sidebar-link">设置源</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#生成二维码" class="sidebar-link">生成二维码</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/#显示环境配置" class="sidebar-link">显示环境配置</a></li></ul></li><li><a href="/dev/DevOps/deploy.html" class="sidebar-link">cli-deploy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/DevOps/deploy.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/deploy.html#初始化配置文件" class="sidebar-link">初始化配置文件</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/deploy.html#自动化部署" class="sidebar-link">自动化部署</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>日志埋点</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/DevOps/sentry.html" aria-current="page" class="active sidebar-link">Sentry</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#什么是-sentry" class="sidebar-link">什么是 Sentry</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#为什么使用-sentry" class="sidebar-link">为什么使用 Sentry</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#如何使用" class="sidebar-link">如何使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#安装-sdk" class="sidebar-link">安装 SDK</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#主动上报" class="sidebar-link">主动上报</a></li></ul></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#关于-dsn" class="sidebar-link">关于 dsn</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#多环境区分" class="sidebar-link">多环境区分</a></li><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#上传-sourcemap" class="sidebar-link">上传 SourceMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/DevOps/sentry.html#w6s-sentry-plugin" class="sidebar-link">@w6s/sentry-plugin</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>持续集成</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/DevOps/jenkins.html" class="sidebar-link">Jenkins</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sentry"><a href="#sentry" class="header-anchor">#</a> Sentry</h1> <p><img src="/dev/sentry-bg.jpg" alt="sentry"></p> <h2 id="什么是-sentry"><a href="#什么是-sentry" class="header-anchor">#</a> 什么是 Sentry</h2> <p>Sentry 是一个开源的实时错误追踪系统，可以帮助开发者实时监控并修复异常问题。它主要专注于持续集成、提高效率并且提升用户体验。Sentry 分为服务端和客户端 SDK，前者可以直接使用它家提供的在线服务，也可以本地自行搭建；后者提供了对多种主流语言和框架的支持，包括 React、Angular、Node、Django、RoR、PHP、Laravel、Android、.NET、JAVA 等。同时它可提供了和其他流行服务集成的方案，例如 GitHub、GitLab、bitbuck、heroku、slack、Trello 等。</p> <p>目前公司的前端项目也都在逐步应用上 Sentry 进行错误日志管理。</p> <p>可以打开<a href="https://sentry.workplus.io" target="_blank" rel="noopener noreferrer">https://sentry.workplus.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行访问，若需要申请账号，请联系相关负责人。</p> <h2 id="为什么使用-sentry"><a href="#为什么使用-sentry" class="header-anchor">#</a> 为什么使用 Sentry</h2> <p>任何项目发布上线，都会经过测试部门的检验。但往往线上问题，都存在偶发性、特殊性，或者难以重现。借助 Sentry，通过异常捕捉或者主动提交日志，可以更快地掌握异常的相关信息，大大减少排查问题成本。</p> <p>一份异常日志，会包含用户的点击行为，网络请求等。同时可以通过 SourceMap 技术，对混淆压缩后的 js 文件进行反编译，精准定位错误代码位置。</p> <h2 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h2> <p>Sentry 官方支持多种前端框架，使用方式大同小异，下面以 Vue 为例：</p> <blockquote><p>更多的框架接入文档，请访问<a href="https://docs.sentry.io/platforms/javascript/" target="_blank" rel="noopener noreferrer">https://docs.sentry.io/platforms/javascript/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="安装-sdk"><a href="#安装-sdk" class="header-anchor">#</a> 安装 SDK</h3> <p>要使用 Sentry，需先安装相应的 SDK，即<code>@sentry/browser</code>，至于<code>@sentry/integrations</code>，主要是用于跟 Vue 关联起来。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save  @sentry/browser @sentry/integrations
</code></pre></div><p>@sentry/browser 将报告通过应用程序触发的任何被捕获的异常。此外，通过 Vue 的 errorHandler 钩子，可以定位到异常所在的组件。</p> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <p>在入口文件敲入以下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Sentry <span class="token keyword">from</span> <span class="token string">&quot;@sentry/browser&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Vue <span class="token keyword">as</span> VueIntegration <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@sentry/integrations&quot;</span><span class="token punctuation">;</span>

Sentry<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  dsn<span class="token operator">:</span> <span class="token string">&quot;https://examplePublicKey@o0.ingest.sentry.io/0&quot;</span><span class="token punctuation">,</span>
  integrations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">VueIntegration</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Vue<span class="token punctuation">,</span> attachProps<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样，Sentry 已经成功接入，但仅能上报全局上捕获的异常！</p> <p>此外，VueIntegration 可以配置以下参数：
：</p> <ul><li><code>Vue</code> 可选的，如果不传入，则 window.Vue 必须存在；</li> <li><code>attachProps</code> 可选的，默认为 true；若设置为 false，将不上报组件相关信息；</li> <li><code>logErrors</code> 可选的，默认为 false；若设置为 true，若出现异常，Vue 的 logError 同样会输出到控制台。</li></ul> <div class="custom-block tip"><p class="custom-block-title">关于 logErrors</p> <p>一旦启用 VueIntegration，异常将不会打印到开发者调试器的 console 中，若需要，请确保 logErrors 为 true。</p></div> <h3 id="主动上报"><a href="#主动上报" class="header-anchor">#</a> 主动上报</h3> <p>偶尔需要对某些特殊功能或者关键性功能进行跟踪，此时可以使用 sentry sdk 提供的 API，主动上报日志。</p> <ul><li>captureEvent</li> <li>captureMessage</li> <li>captureException</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Sentry <span class="token keyword">from</span> <span class="token string">'@sentry/browser'</span><span class="token punctuation">;</span>

<span class="token comment">// Capture exceptions, messages or manual events</span>
Sentry<span class="token punctuation">.</span><span class="token function">captureMessage</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Sentry<span class="token punctuation">.</span><span class="token function">captureException</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Good bye'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Sentry<span class="token punctuation">.</span><span class="token function">captureEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token string">'Manual'</span><span class="token punctuation">,</span>
  stacktrace<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通常使用以上 3 个 API 为主，详情其查看<a href="https://github.com/getsentry/sentry-javascript/tree/master/packages/browser#usage" target="_blank" rel="noopener noreferrer">接口用例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="关于-dsn"><a href="#关于-dsn" class="header-anchor">#</a> 关于 dsn</h2> <p>一个 dsn，大概是长下面的样子，每个项目的 dsn 都是唯一的：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># http（不推荐）</span>
http://d4c5b124775b2484ac6d4dbb48b@121.40.118.145:8080/232

<span class="token comment"># https（推荐）</span>
https://d4c5b124775b2484ac6d4dbb48b@sentry.workplus.io/232
</code></pre></div><p>在 Sentry 上创建项目后，将可获取到相应的 dsn。</p> <p>需要注意的是，目前配置获取到的是 http 的 ip段 dsn，在一些以 https 访问的应用上，日志无法正常上报，所以，<strong>请确保使用 https 协议</strong>。</p> <p>如上，把<code>http://</code>协议改成<code>https://</code>，同时，<code>IP+端口</code>，改成域名访问地址<code>sentry.workplus.io</code>。</p> <h2 id="多环境区分"><a href="#多环境区分" class="header-anchor">#</a> 多环境区分</h2> <p>大多情况下，一个项目需要经过开发、测试到发布的阶段，而每个阶段，可能存在多种环境。</p> <p>为了可以清晰地区分不同的环境，可以使用<code>configureScope</code>进行设置，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Sentry <span class="token keyword">from</span> <span class="token string">'@sentry/browser'</span><span class="token punctuation">;</span>

<span class="token comment">// Set user information, as well as tags and further extras</span>
Sentry<span class="token punctuation">.</span><span class="token function">configureScope</span><span class="token punctuation">(</span><span class="token parameter">scope</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  scope<span class="token punctuation">.</span><span class="token function">setExtra</span><span class="token punctuation">(</span><span class="token string">'battery'</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scope<span class="token punctuation">.</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token string">'user_mode'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scope<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'4711'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// scope.clear();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果是主动上报的日志，可以通过拼装用户信息到日志标题中，用于快速区分，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在 message 中带上用户id</span>
Sentry<span class="token punctuation">.</span><span class="token function">captureEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">登录异常-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  stacktrace<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">关于开发阶段</p> <p>开发阶段尽可能不要开启日志上报功能，除非需要处理特殊的事情，否则将会产生过多无谓的异常日志。可以通过<code>process.env.NODE_ENV</code>来判断，若为<code>development</code>，即不初始化 Sentry。</p></div> <h2 id="上传-sourcemap"><a href="#上传-sourcemap" class="header-anchor">#</a> 上传 SourceMap</h2> <p>通过 w6s-cli 创建的项目，已经具备这样的功能（非默认），通过简单配置，即可实现上传功能，<a href="/dev/#sentry">查看配置</a>。</p> <p>该功能是通过<a href="https://github.com/getsentry/sentry-webpack-plugin" target="_blank" rel="noopener noreferrer">@sentry/webpack-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现，其他非 w6s-cli 创建的项目，可以直接使用该插件来实现 sourceMap 文件上传，但请注意，<strong>请不要把 sourceMap 文件发布到生产环境</strong>。</p> <h3 id="w6s-sentry-plugin"><a href="#w6s-sentry-plugin" class="header-anchor">#</a> @w6s/sentry-plugin</h3> <p><code>@w6s/sentry-plugin</code>是一个基于<a href="https://github.com/40thieves/webpack-sentry-plugin" target="_blank" rel="noopener noreferrer">webpack-sentry-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 做的上层封装插件，使用起来更加方便，只需简单配置即可。</p> <p>创建<code>sentry.config.js</code>文件，使用该插件前，需要在 sentry 上创建项目并获取<code>apiKey</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sentry.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  enable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  project<span class="token operator">:</span> <span class="token string">'your-project-name'</span><span class="token punctuation">,</span>
  apiKey<span class="token operator">:</span> <span class="token string">'sentry-auth-token'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>字段解析：</p> <ul><li><code>enable</code>: 是否开启 Sentry 上传功能；</li> <li><code>project</code>: 在 Sentry 上创建的项目的名称；</li> <li><code>apiKey</code>: 在 Sentry 上创建的项目的 apiKey，可以在设置中找到。</li></ul> <p>只要是基于<code>w6s-cli</code>或<code>vue-cli</code>创建的项目，均支持使用。在配置文件的<code>pluginOptions</code>属性中添加配置即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// w6s.config.js</span>
<span class="token keyword">const</span> sentry <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./sentry.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  pluginOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加 sentry 配置</span>
    sentry<span class="token punctuation">,</span>
    <span class="token comment">// 其他插件配置</span>
    <span class="token comment">// ....</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">关于 @w6s/sentry-plugin 的配置</p> <p><code>@w6s/sentry-plugin</code>的配置非常少，那是因为该插件完全是按照团队 sentry 服务进行了默认配置，而需要配置的，仅是跟项目关联的项目名称<code>project</code>和项目对应的<code>apiKey</code>。</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/WorkPlusFE/cli/edit/master/docs/DevOps/sentry.md" target="_blank" rel="noopener noreferrer">帮助 WorkPlusFE 改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">11/13/2020, 4:54:53 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev/DevOps/deploy.html" class="prev">
        cli-deploy
      </a></span> <span class="next"><a href="/dev/DevOps/jenkins.html">
        Jenkins
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/dev/assets/js/app.f1eb2c07.js" defer></script><script src="/dev/assets/js/2.e5260363.js" defer></script><script src="/dev/assets/js/10.b17e0bf5.js" defer></script>
  </body>
</html>
